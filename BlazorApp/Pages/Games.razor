@page "/games"
@using System.Diagnostics
@using System.Net
@using System.Net.Http.Json
@using System.Reflection.Metadata
@using System.Runtime.CompilerServices
@using System.Threading
@using Microsoft.AspNetCore.Razor.TagHelpers
@inject HttpClient HttpClient
@inject IJSRuntime JS

<section id="games">
    <img @onclick="() => click(1)" id="1" src="img/macron.gif"/>
    <img @onclick="() => click(2)" id="2" src="img/shrek.gif"/>
    <img @onclick="() => click(3)" id="3" src="img/alegre.gif"/>
    <img @onclick="() => click(4)" id="4" src="img/mask.gif"/>
    <img @onclick="() => click(5)" id="5" src="img/melanchon.gif"/>
    <img @onclick="() => click(6)" id="6" src="img/zemmour.gif"/>
</section>


<a @onclick="Start">Start</a>
<a>Nombre d'image cliqu√© : @Image</a>
<a>Ancien Score : @Historique</a>
<a @onclick="() => PostScore()">Save Game</a>
@code {

    static int Image = 0;
    static int Historique = 0;

    private void Start()
    {
        JS.InvokeAsync<object>("start");
    }

    private void click(int id)
    {
        JS.InvokeAsync<object>("hidden", id);
        JS.InvokeAsync<object>("visible");
        Image ++;
    }
    
    [JSInvokable]
    public static void Finish()
    {
        Console.WriteLine("finis");
        Historique = Image;
        Image = 0;
        Console.WriteLine("test mec");
    }
    
    protected async Task PostScore()
    {
        if (Image != 0)
        {
            var postBody = new {    
                IdUser = "1",
                Score = Image,
                Date =  DateTime.Now
            };
            using var response = await HttpClient.PostAsJsonAsync("https://localhost:5001/api/history", postBody);
        }
        else
        {
            Console.WriteLine("pas mtn");
        }


        // convert response data to Article object
        // article = await response.Content.ReadFromJsonAsync<Article>();
    }

}